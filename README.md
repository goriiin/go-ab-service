# Go A/B Service

Платформа для проведения A/B-тестирования, построенная на Go. Система позволяет централизованно управлять экспериментами и получать решения как через прямой API-вызов, так и с помощью высокопроизводительного клиентского SDK.

## Архитектура

-   **`central-api`**: REST API для управления экспериментами (CRUD) и получения синхронных решений.
-   **`postgres`**: "Источник истины" для конфигураций экспериментов.
-   **`outbox-worker` & `kafka`**: Реализуют паттерн Transactional Outbox для надежной асинхронной доставки изменений.
-   **`snapshot-generator` & `minio`**: Создают и хранят полные снимки конфигураций для быстрой загрузки клиентами.
-   **`client-sdk`**: Клиентская библиотека Go для интеграции в сервисы. Принимает решения локально, обновляя конфигурацию в фоне.
-   **`example-sort-app`**: Сервис-пример, использующий `client-sdk` для A/B-теста алгоритма сортировки.


### Запуск

```bash
# Запустить все сервисы, включая базу данных и сервис-пример
make up
```

### Тестирование

1.  **Создать и активировать эксперимент:**
    Используйте скрипты из файла `docs/curl-requests.md`. Они создадут эксперимент, активируют его и покажут, как запросить решение.

2.  **Проверить сервис-пример:**
    Отправьте запрос, чтобы увидеть, как A/B-тест влияет на сортировку.

    ```bash
    # Этот пользователь, скорее всего, получит сортировку по убыванию
    curl -X POST http://localhost:8081/sort \
    -H "Content-Type: application/json" \
    -d '{"user_id": "user-desc", "numbers": [1,5,3,2,4]}'

    # Этот пользователь, скорее всего, получит сортировку по возрастанию
    curl -X POST http://localhost:8081/sort \
    -H "Content-Type: application/json" \
    -d '{"user_id": "user-asc", "numbers": [1,5,3,2,4]}'
    ```

### Юнит-тесты

Для запуска тестов `central-api`:

```bash
go test ./internal/delivery/...
```